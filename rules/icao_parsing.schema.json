{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://briefingbuddy.local/schemas/icao_parsing.schema.json",
  "title": "ICAO Field Parsing Rules (Strict-first)",
  "type": "object",
  "required": [
    "version",
    "strictFirst",
    "fields",
    "dateParsing"
  ],
  "properties": {
    "version": {
      "type": "string"
    },
    "strictFirst": {
      "type": "boolean",
      "const": true
    },
    "fields": {
      "type": "object",
      "required": [
        "requiredFields",
        "supportedFields"
      ],
      "properties": {
        "requiredFields": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "Q",
              "A",
              "B",
              "C",
              "E"
            ]
          },
          "uniqueItems": true
        },
        "supportedFields": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "Q",
              "A",
              "B",
              "C",
              "D",
              "E",
              "F",
              "G"
            ]
          },
          "uniqueItems": true
        },
        "regex": {
          "type": "object",
          "description": "Regex patterns used by the engine to extract ICAO fields.",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "dateParsing": {
      "type": "object",
      "required": [
        "acceptedFormats",
        "timezone"
      ],
      "properties": {
        "timezone": {
          "type": "string",
          "default": "UTC"
        },
        "acceptedFormats": {
          "type": "array",
          "items": {
            "type": "string",
            "description": "Format tokens for the parser implementation (engine-specific)."
          },
          "minItems": 1
        },
        "permTokens": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": [
            "PERM",
            "PERMANENT"
          ]
        }
      },
      "additionalProperties": false
    },
    "errorMetadata": {
      "type": "object",
      "properties": {
        "storeErrorsWithBriefing": {
          "type": "boolean",
          "default": true
        },
        "includeRawSourceSnippet": {
          "type": "boolean",
          "default": true
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}